{
  "title": "关于React diff的一些理解",
  "time": "2016-12-13 09:39",
  "notebook": "react"
}


# 关于React diff的一些理解

React diff 算法，实际上解决的是将 O(n^3) 复杂度的问题转换成 O(n) 复杂度的问题

> ### diff 策略

> 一、 Web UI 中 DOM 节点跨层级的移动操作特别少，可以忽略不计。

> 二、 拥有相同类的两个组件将会生成相似的树形结构，拥有不同类的两个组件将会生成不同的树形结构。

> 三、 对于同一层级的一组子节点，它们可以通过唯一 id 进行区分。


### tree diff

tree diff 指的是在前后两个虚拟DOM树比较过程中，只对同一层进行比较，这样子明显只要遍历一遍就行了。它在操作的时候只有删除和添加。

如果出现了跨层级的移动DOM，就会直接删除它在原来的位置，然后在新的位置重新创建，这样子其实影响了它的性能。所以最好不要进行跨层级移动DOM。

### component diff

还是进行一层一层的比较。如果出现了一个节点改变了，那么它会替换这个节点和它下面的所有子节点。

如果设置了shouldComponentUpdate 返回值是false，那么将认定这个节点不变，不去进行diff，节约了时间。

### element diff

同一层级的节点比较，diff会有三个操作，添加，删除，还有移动。

在同一层级的diff中会有一个问题，就是先后顺序问题，有时候，其实所有的节点都是原来的节点，只不过是修改了先后顺序而已，这个时候，diff下来肯定是很多对不上的，如果进行删除和添加操作，肯定会影响性能。

这个时候，就要靠key来帮忙了。当设置了key之后，在diff过程中，会默认将同样的key的节点进行匹配diff。这样就能免去不必要的添加删除操作，只要移动就行了。

diff的本质，就是通过设置一些规则，让diff算法变得快速直接。
